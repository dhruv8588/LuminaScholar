{% extends 'base.html' %}
{% block content %}

<style>
 .list-group-item {
      background-color: transparent; /* To remove default background */
      padding: 0; /* To remove default padding */
  }
  
  .list-link {
      display: block;
      padding: 10px 15px; /* Add padding to create a clickable area */
      text-decoration: none; /* Remove underline */
      color: #333; /* Default color */
      transition: color 0.3s; /* Smooth color transition on hover */
  }
  
  .list-link:hover {
      cursor: pointer;
      text-decoration: none;
      background-color: #d3d3d3;
      color: #808080; /* Change color on hover */
  }
  
  .selected {
      background-color: #d3d3d3;
      padding: 10px 15px; /* Add padding to create a clickable area */
  }

  .file-upload__label {
    color: #aaa;
  }

  .green-check {
    color: green;
  } 
  
</style>  

<div class="row">
    
    <div class="col-md-4">
        <br/><br/>
        <a href="{% url 'unsubmitted_manuscripts' %}" class="btn btn-secondary" style="width: 18rem; margin-left: 50px;"><b><i class="fas fa-angle-left"></i>&nbsp;Author Dashboard</b></a><br/><br/>
        <div class="card" style="width: 18rem; margin-left: 50px;">
            <div class="card-header">
                <b>Submission</b>
            </div>
            <ul class="list-group list-group-flush">
                <li class="list-group-item"><a href="{% url 'submit_paper_step1' paper.id %}" class="list-link">Step 1: Type, Title, & Abstract
                  {% if paper.type and paper.title and paper.abstract %}
                        <i class="fas fa-check"></i>
                  {% endif %}   
                </a></li>
                <li class="list-group-item"><a href="{% url 'submit_paper_step2' paper.id %}" class="list-link">Step 2: Authors
                  {% if paper.authors.all %}
                    <i class="fas fa-check green-check"></i>
                  {% endif %}
                </a></li>
                <li class="list-group-item"><a href="{% url 'submit_paper_step3' paper.id %}" class="list-link">Step 3: Attributes
                  {% if paper.attributes.all %}
                        <i class="fas fa-check green-check"></i>
                  {% endif %}
                </a></li>
                <li class="list-group-item selected">Step 4: File Upload
                  {% if paper.files.all %}
                      <i class="fas fa-check green-check"></i>
                  {% endif %}
                </li>
                <li class="list-group-item"><a href="{% url 'submit_paper_step5' paper.id %}" class="list-link">Step 5: Details & Comments
                  {% if paper.number_of_figures and paper.number_of_tables and paper.word_count and paper.MSWord_file and paper.certification_form and paper.publish_elsewhere and paper.approval and paper.figures_tables_published_elsewhere  %}
                    {% if paper.figures_tables_published_elsewhere == 'Yes' %}  
                      {% if figures_tables_published_elsewhere_desc %}
                        <i class="fas fa-check green-check"></i>
                      {% endif %}  
                    {% endif %}
                  {% endif %}
                </a></li>
                <li class="list-group-item"><a href="{% url 'submit_paper_step6' paper.id %}" class="list-link">Step 6: Review & Submit</a></li>
            </ul>
        </div>
    </div>

    <div class="col-md-8">
        <div style="margin-right: 100px;">
        <br/>
        <h2>Step 4: File Upload</h2>
        <p style="color: #54626F;">Upload as many files as needed for your manuscript in groups of three or fewer. These files will be combined into a single PDF document for the peer review process. If you are submitting a revision, please include only the latest set of files. If you have updated a file, please delete the original version and upload the revised file. To designate the order in which your files appear, use the dropdowns in the "order" column below. When you are finished, click "Save and Continue."<br/><span class="red-asterisk">*</span> = Required Fields</p>


        <section id="files" class="col-12">
            {% include 'partials/files.html' %}
        </section>
        <br/>

        <form hx-encoding="multipart/form-data" hx-post="{% url 'upload_file' paper.id %}" hx-target="#files" id="myform">
            {% csrf_token %}

            <div class="file-upload form-group">
                <input class="file-upload__input" type="file" name="file1" style="display:none">
                <button class="btn btn-sm btn-info file-upload__button" type="button"><i class="fas fa-paperclip"></i>&nbsp;Select File 1...</button>
                <span class="file-upload__label"></span>
                <button class="btn btn-sm btn-danger file-upload__reset" type="button">Reset</button>
            </div>

            <div class="file-upload form-group">
                <input class="file-upload__input" type="file" name="file2" style="display:none">
                <button class="btn btn-sm btn-info file-upload__button" type="button"><i class="fas fa-paperclip"></i>&nbsp;Select File 2...</button>
                <span class="file-upload__label"></span>
                <button class="btn btn-sm btn-danger file-upload__reset" type="button">Reset</button>
            </div>

            <div class="file-upload form-group">
                <input class="file-upload__input" type="file" name="file3" style="display:none">
                <button class="btn btn-sm btn-info file-upload__button" type="button"><i class="fas fa-paperclip"></i>&nbsp;Select File 3...</button>
                <span class="file-upload__label"></span>
                <button class="btn btn-sm btn-danger file-upload__reset" type="button">Reset</button>
            </div>

            <button type="submit" class="btn btn-success btn-sm"><i class="fas fa-upload"></i>&nbsp;Upload Files</button>

            <button type="button" class="btn btn-danger btn-sm" hx-delete="{% url 'delete_all_files' paper.id %}" hx-target="#files"
            hx-confirm="Are you sure you wish to delete all files?">
                <i class="fas fa-trash"></i>&nbsp;Remove all files
            </button>
        </form>

        <hr/>
        <div style="display: inline-block; float: left;">
            <a href="{% url 'submit_paper_step3' paper.id %}" class="btn btn-dark btn-sm"><i class="fas fa-angle-left"></i>&nbsp;Previous Step</a>
          </div>
          <div style="display: inline-block; float: right;">
            <a href="{% url 'submit_paper_step5' paper.id %}" class="btn btn-dark btn-sm">Continue&nbsp;<i class="fas fa-angle-right"></i></a>
          </div>
    </div>
    </div>   
</div> 

  
<script>

    document.querySelectorAll(".file-upload__button").forEach(
        function(button) {
            const hiddenInput = button.parentElement.querySelector(
                ".file-upload__input"
            );
            const label = button.parentElement.querySelector(".file-upload__label");
            const defaultLabelText = "No file selected";

            label.textContent = defaultLabelText;
            label.title = defaultLabelText;

            button.addEventListener("click", function() {
                hiddenInput.click();
            });

            hiddenInput.addEventListener("change", function() {
                const filename = hiddenInput.files[0].name;
                label.textContent = filename || defaultLabelText;
                label.title = label.textContent;
            });

            const resetButton = button.parentElement.querySelector(".file-upload__reset"); 
            resetButton.addEventListener("click", function() {
                hiddenInput.value = ""; 
                label.textContent = defaultLabelText;
                label.title = defaultLabelText;
            });

            document.body.addEventListener('htmx:afterSwap', function(evt) {
                const form = document.querySelector("#myform");
                // form.reset();
                hiddenInput.value = ""; 
                label.textContent = defaultLabelText;
                label.title = defaultLabelText;
            });
        }
    );

</script>

{% endblock %}

